mod application;

class Main {

    static fn print(var[] message) {
        __asm("odessy/x64/print.asm");
    }

    static fn fact(var x) : var {
        return (x == 1 ? x : x * fact(x - 1));
        try {
        __asm(
            "movl 1"
            "new_class <Throwable>"
            "movr %adx,%fp"
            "smov %ebx"
            "movi 1,%ecx"
            "test %ecx,%ebx"
            "movi $L1,%adx"
            "ifne"
            "movr %adx,%fp"
            "smovr %ebx-0x5"
            "ret"
            ".L1:"
            "dec %ebx"
            "inc %sp"
            "iframe"
            "pushr %ebx"
            "call <fact>"
            "movr %adx,%sp"
            "smov %ebx"
            "movr %adx,%fp"
            "smov %ecx"
            "mul %ecx,%ebx"
            "smovr %bmr-0x5"
            "ret"
        );
        } catch(Throwable e) {
            __asm("ret");
        }
    }

    static fn main(string[] args) : var {
        var[] str = "factorial of 7 is ";
        // fact(x);
        __asm("odessy/x64/compute_factorial.asm");
    }
}