mod application;

class Base {

    static fn print2(var[] message) {
        __asm("odessy/x64/print.asm");
    }
}

class Main base Base {

    var x;
    Main mm;

    static fn print(var[] message) {
        __asm("odessy/x64/print.asm");
    }

    static fn printc(var char) {
        __asm("odessy/x64/printc.asm");
    }

    static fn foo(Main main) {

    }

    static fn fact(var x) : var {
       // return (x == 1 ? x : x * fact(x - 1));
        try {
        __asm(
            "movr %adx,%fp"
            "smov %ebx"
            "movi 1,%ecx"
            "movi $L1,%adx"
            "le ebx,ecx"
            "ifne"
            "movr %adx,%fp"
            "smovr %ebx-0x5"
            "ret"
            ".L1:"
            "movr ecf,ebx"
            "dec %ecf"
            "inc %sp"
            "iframe"
            "pushr %ecf"
            "call <fact>"
            "movr %adx,%sp"
            "smov %ebx"
            "movr %adx,%fp"
            "smov %ecx"
            "mul %ecx,%ebx, %bmr"
            "smovr %bmr-0x5"
            "ret"
        );
        } catch(Throwable e) {
            __asm("ret");
        }
    }

    static fn operator++(var x) {
        x + 1;
    }

    static fn operator+(var x) : var {
        x = new Main();
        return 1;
    }

    static fn operator<<(var x) : var {
        x = new Main();
        return 1;
    }

    static fn operator<<(Main x) : var {
        x = new Main();
        return 1;
    }

    static fn operator+=(var x) : var {
        x = new Main();
        return 1;
    }


    static fn main(string[] args) : var {
        var[] str = "factorial of 8 is ";

        var[] arry = new var[10];
        foreach(var x : arry) {
            printc(fact(1));
            __asm("movi ' ',ebx" "_putc ebx");
            printc(x);
            __asm("movi ' ',ebx" "_putc ebx");
        }

        for(var i = 0; i < 10; i++) {
        }

        var x = 5;
        while((--x) > 0) {
            printc(x);
            __asm("nop movi ' ',ebx" "_putc ebx");
        }
        print("done1\n");

        try {
            do {
                x++;
            }while(x < 10);
            throw new RuntimeErr("Hello first error");
        }
         catch(RuntimeErr e) {
            print("caught error ");
            print(e.message);
            print("\n");
        } finally {

        }

        print2("doing if statements\n");
        x = 11;
        __asm("nop nop");
        if(x == 6) {
            print("x == 6");
        } else if(x == 10) {
            print("x == 10");
        } else if(arry == null) {
            print2("arry == null");
        } else if(arry != null) {
            print2("arry != null");
        } else {
            print("im not sure what x is?");
        }

        print("done");


        __asm("movi ' ',ebx" "_putc ebx");
        __asm(
            "movr %adx,%sp"
            "smov %ebx"
            "put %ebx"
         );
        //fact(6);
        //__asm("odessy/x64/compute_factorial.asm");
    }
}