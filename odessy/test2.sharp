mod application;

class Main {

    static fn print(var[] message) {
        __asm("odessy/x64/print.asm");
    }

    static fn fact(var x) : var {
        return (x == 1 ? x : x * fact(x - 1));
        try {
        __asm(
            "movr %adx,%fp"
            "smov %ebx"
            "put ebx"
            "movi ' ',egx"
            "_putc egx"
            "movi 1,%ecx"
            "movi $L1,%adx"
            "le ebx,ecx"
            "ifne"
            "movr %adx,%fp"
            "smovr %ebx-0x5"
            "ret"
            ".L1:"
            "movr ecf,ebx"
            "dec %ecf"
            "inc %sp"
            "iframe"
            "pushr %ecf"
            "call <fact>"
            "movr %adx,%sp"
            "smov %ebx"
            "movr %adx,%fp"
            "smov %ecx"
            "mul %ecx,%ebx"
            "smovr %bmr-0x5"
            "ret"
        );
        } catch(Throwable e) {
            __asm("ret");
        }
    }

    static fn main(string[] args) : var {
        var[] str = "factorial of 8 is ";
        fact(str[9]);
        __asm(
            "movr %adx,%sp"
            "smov %ebx"
            "put %ebx"
         );
        //fact(6);
        //__asm("odessy/x64/compute_factorial.asm");
    }
}